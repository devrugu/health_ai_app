// .devcontainer/devcontainer.json
{
  "name": "Flutter Dev Container",
  "image": "mcr.microsoft.com/devcontainers/base:ubuntu",

  // NEW: Define environment variables for the container.
  "containerEnv": {
    // This tells Flutter to use this specific command to run Chrome.
    // We add the --no-sandbox flag which is crucial for container environments.
    "CHROME_EXECUTABLE": "/usr/bin/google-chrome-stable --no-sandbox"
  },

  "customizations": {
    "vscode": {
      "extensions": [
        "Dart-Code.flutter"
      ]
    }
  },

  "forwardPorts": [
    60000
  ],
  "portsAttributes": {
    "60000": {
      "label": "Flutter Web App",
      "onAutoForward": "openBrowser"
    }
  },

  // UPDATED: The postCreateCommand is now much more robust.
  // It installs dependencies, downloads Chrome, installs it, and then installs Flutter.
  "postCreateCommand": "sudo apt-get update && sudo apt-get install -y wget unzip libglu1-mesa xvfb && wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb && sudo apt install -y ./google-chrome-stable_current_amd64.deb && rm google-chrome-stable_current_amd64.deb && git clone https://github.com/flutter/flutter.git /usr/local/flutter && sudo ln -s /usr/local/flutter/bin/flutter /usr/local/bin/flutter && flutter doctor"
}